<script>
/* =======================
   GLOBAL STATE
======================= */
let currentLang = "en";
let currentTheme = "light";
let selectedCategory = null;
let selectedItem = null;
let selectedQty = 1;
let order = [];

/* =======================
   MOCK DATA (ITEMS)
======================= */
const ITEMS = {
  housekeeping: [
    { id: "towel", name: "Extra Towels", emoji: "ðŸ§»", price: 200 },
    { id: "pillow", name: "Extra Pillow", emoji: "ðŸ›ï¸", price: 300 },
    { id: "clean", name: "Room Cleaning", emoji: "ðŸ§¹", price: 500 }
  ],
  maintenance: [
    { id: "ac", name: "Air Conditioner", emoji: "â„ï¸", price: 0 },
    { id: "light", name: "Light Issue", emoji: "ðŸ’¡", price: 0 },
    { id: "plumbing", name: "Plumbing", emoji: "ðŸš¿", price: 0 }
  ],
  reception: [
    { id: "wake", name: "Wake-up Call", emoji: "â°", price: 0 },
    { id: "taxi", name: "Taxi Request", emoji: "ðŸš•", price: 0 }
  ],
  roomservice: [
    { id: "burger", name: "Burger", emoji: "ðŸ”", price: 1200 },
    { id: "pizza", name: "Pizza", emoji: "ðŸ•", price: 1500 },
    { id: "water", name: "Water", emoji: "ðŸ¥¤", price: 200 }
  ]
};

/* =======================
   DOM ELEMENTS
======================= */
const categoryView = document.getElementById("categoryView");
const detailedView = document.getElementById("detailedView");
const detailedList = document.getElementById("detailedList");
const backBtn = document.getElementById("backBtn");
const quantityBox = document.getElementById("quantityContainer");
const qtyDisplay = document.getElementById("quantityDisplay");
const addToOrderBtn = document.getElementById("addToOrderBtn");
const orderSummaryBox = document.getElementById("orderSummaryBox");
const orderItemsList = document.getElementById("orderItemsList");
const totalPriceBox = document.getElementById("totalPriceBox");
const totalPriceAmount = document.getElementById("totalPriceAmount");
const statusMessage = document.getElementById("statusMessage");
const form = document.getElementById("requestForm");

/* =======================
   CATEGORY SELECTION
======================= */
document.querySelectorAll(".request-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    selectedCategory = btn.dataset.category;
    loadItems();
    categoryView.classList.remove("active");
    detailedView.classList.add("active");
    backBtn.classList.add("show");
  });
});

/* =======================
   LOAD ITEMS
======================= */
function loadItems() {
  detailedList.innerHTML = "";
  resetSelection();

  ITEMS[selectedCategory].forEach(item => {
    const el = document.createElement("div");
    el.className = "detailed-item";
    el.innerHTML = `
      <span class="emoji">${item.emoji}</span>
      <span class="label">${item.name}</span>
    `;
    el.onclick = () => selectItem(item, el);
    detailedList.appendChild(el);
  });
}

/* =======================
   ITEM SELECTION
======================= */
function selectItem(item, element) {
  document.querySelectorAll(".detailed-item").forEach(i => i.classList.remove("selected"));
  element.classList.add("selected");

  selectedItem = item;
  selectedQty = 1;
  qtyDisplay.textContent = selectedQty;

  quantityBox.style.display = "block";
  addToOrderBtn.classList.add("show");
  updateItemPrice();
}

/* =======================
   QUANTITY CONTROL
======================= */
document.getElementById("increaseQty").onclick = () => {
  selectedQty++;
  qtyDisplay.textContent = selectedQty;
  updateItemPrice();
};

document.getElementById("decreaseQty").onclick = () => {
  if (selectedQty > 1) selectedQty--;
  qtyDisplay.textContent = selectedQty;
  updateItemPrice();
};

/* =======================
   ADD TO ORDER
======================= */
addToOrderBtn.onclick = () => {
  const existing = order.find(i => i.id === selectedItem.id);
  if (existing) {
    existing.qty += selectedQty;
  } else {
    order.push({ ...selectedItem, qty: selectedQty });
  }
  resetSelection();
  renderOrder();
};

/* =======================
   ORDER RENDER
======================= */
function renderOrder() {
  orderItemsList.innerHTML = "";
  let total = 0;

  order.forEach(item => {
    const itemTotal = item.price * item.qty;
    total += itemTotal;

    const row = document.createElement("div");
    row.className = "order-item";
    row.innerHTML = `
      <div class="order-item-info">
        <span>${item.emoji}</span>
        <div>
          <div class="order-item-name">${item.name}</div>
          <div class="order-item-qty">x${item.qty}</div>
        </div>
      </div>
      <div>
        <span class="order-item-price">${itemTotal} DA</span>
        <button class="order-item-remove">âœ•</button>
      </div>
    `;

    row.querySelector("button").onclick = () => {
      order = order.filter(o => o.id !== item.id);
      renderOrder();
    };

    orderItemsList.appendChild(row);
  });

  orderSummaryBox.classList.toggle("show", order.length > 0);
  totalPriceBox.classList.toggle("show", total > 0);
  totalPriceAmount.textContent = total + " DA";
}

/* =======================
   FORM SUBMIT
======================= */
form.onsubmit = e => {
  e.preventDefault();
  if (order.length === 0) return;

  statusMessage.className = "status-message sending";
  statusMessage.textContent = translations[currentLang].sending;

  setTimeout(() => {
    statusMessage.className = "status-message success";
    statusMessage.textContent = translations[currentLang].staffAssigned;

    setTimeout(resetAll, 3000);
  }, 10000);
};

/* =======================
   RESET EVERYTHING
======================= */
function resetAll() {
  form.reset();
  order = [];
  resetSelection();
  renderOrder();

  detailedView.classList.remove("active");
  categoryView.classList.add("active");
  backBtn.classList.remove("show");
  statusMessage.style.display = "none";
}

function resetSelection() {
  selectedItem = null;
  selectedQty = 1;
  quantityBox.style.display = "none";
  addToOrderBtn.classList.remove("show");
  totalPriceBox.classList.remove("show");
  document.querySelectorAll(".detailed-item").forEach(i => i.classList.remove("selected"));
}

function updateItemPrice() {
  if (!selectedItem) return;
  totalPriceBox.classList.add("show");
  totalPriceAmount.textContent = (selectedItem.price * selectedQty) + " DA";
}

/* =======================
   BACK BUTTON
======================= */
backBtn.onclick = () => {
  detailedView.classList.remove("active");
  categoryView.classList.add("active");
  backBtn.classList.remove("show");
};
</script>
